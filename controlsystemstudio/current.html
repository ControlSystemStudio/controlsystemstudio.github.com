<!DOCTYPE html>
<!--[if IE 7]> <html lang="en" class="ie7"> <![endif]-->  
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->  
<head>
    <title>CS-Studio | Welcome...</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- CSS Global Compulsory-->
    <link rel="stylesheet" href="../assets/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/headers/header1.css">
    <link rel="stylesheet" href="../assets/plugins/bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="../assets/css/style_responsive.css">
    <link rel="shortcut icon" href="../favicon.ico">        
    <!-- CSS Implementing Plugins -->    
    <link rel="stylesheet" href="../assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="../assets/plugins/flexslider/flexslider.css" type="text/css" media="screen">          
    <!-- CSS Theme -->    
    <link rel="stylesheet" href="../assets/css/themes/default.css" id="style_color">
    <link rel="stylesheet" href="../assets/css/themes/headers/default.css" id="style_color-header-1">
	
    <!-- Start of Woopra Code -->
    <script type="text/javascript">
        function woopraReady(tracker) {
            tracker.setDomain('controlsystemstudio.github.io');
            tracker.setIdleTimeout(1800000);
            tracker.track();
            return false;
        }
        (function() {
            var wsc = document.createElement('script');
            wsc.src = document.location.protocol+'//static.woopra.com/js/woopra.js';
            wsc.type = 'text/javascript';
            wsc.async = true;
            var ssc = document.getElementsByTagName('script')[0];
            ssc.parentNode.insertBefore(wsc, ssc);
        })();
    </script>
    <!-- End of Woopra Code -->
	<style>
		.well{
			padding:19px 15px 19px 15px;
		}
		.nav-list{
			background-color:#f5f5f5;
		}
	</style>
</head>

<body>
<!--==Link to GitHub==-->
<a href="https://github.com/ControlSystemStudio/cs-studio" class="cornerGitHubLink"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>

<!--=== Style Switcher ===-->    
<i class="style-switcher-btn icon-cogs"></i>
<div class="style-switcher">
    <div class="theme-close"><i class="icon-remove"></i></div>
    <div class="theme-heading">Theme Colors</div>
    <ul class="unstyled">
        <li class="theme-default theme-active" data-style="default" data-header="light"></li>
        <li class="theme-blue" data-style="blue" data-header="light"></li>
        <li class="theme-orange" data-style="orange" data-header="light"></li>
        <li class="theme-red" data-style="red" data-header="light"></li>
        <li class="theme-light" data-style="light" data-header="light"></li>
    </ul>
</div><!--/style-switcher-->
<!--=== End Style Switcher ===-->    

<!--=== Top ===-->    
<div class="top">
    <div class="container">         
        <ul class="loginbar pull-right">
            <li><i class="icon-globe"></i><a>Languages <i class="icon-sort-up"></i></a>
                <ul class="nav-list">
                    <li class="active"><a href="#">English</a> <i class="icon-ok"></i></li>
                    <li><a href="#">Spanish</a></li>
                    <li><a href="#">Russian</a></li>
                    <li><a href="#">German</a></li>
                </ul>
            </li>   
            <li class="devider">&nbsp;</li>
            <li><a href="#" class="login-btn">Help</a></li>
            <li class="devider">&nbsp;</li>
            <li><a href="#" class="login-btn">Login</a></li>
        </ul>
    </div>      
</div><!--/top-->
<!--=== End Top ===-->    

<!--=== Header ===-->
<div class="header">               
    <div class="container"> 
        <!-- Logo -->       
        <div class="logo">                                             
            <a href="../index.html"><img id="logo-header" src="../cs-studio/img/css.png" alt="Logo"></a>
        </div><!-- /logo -->        
                                    
        <!-- Menu -->       
        <div class="navbar">                                
            <div class="navbar-inner">                                  
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a><!-- /nav-collapse -->                                  
                <div class="nav-collapse collapse">                                     
                    <ul class="nav top-2">
                        <li class="active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home
                                <b class="caret"></b>                            
                            </a>
                            <ul class="dropdown-menu">
                                <li class="active"><a href="../">Home</a></li>
                            </ul>
                            <b class="caret-out"></b>                        
                        </li>
                        <li>
                            <a href="" class="dropdown-toggle" data-toggle="dropdown">Pages
                                <b class="caret"></b>                            
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="../page_about.html">About Us</a></li>
                                <li><a href="../contribute.html">Contribute</a></li>
                                <li><a href="../records.html">Documentation and Records</a></li>
                            </ul>
                            <b class="caret-out"></b>                        
                        </li>
                        <li>
                            <a href="" class="dropdown-toggle" data-toggle="dropdown">Features
                                <b class="caret"></b>                            
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="https://github.com/ControlSystemStudio/cs-studio/wiki/BEAST">BEAST</a></li>
                                <li><a href="https://github.com/ControlSystemStudio/cs-studio/wiki/BOY">BOY</a></li>
                                <li><a href="https://github.com/ControlSystemStudio/cs-studio/wiki/DataBrowser">DataBrowser</a></li>
                                <li><a href="https://github.com/ControlSystemStudio/cs-studio/wiki/LogbookSupport">Logbook</a></li>
                                <li><a href="#">Scan Client</a></li>
                            </ul>
                            <b class="caret-out"></b>                        
                        </li>
                        <li><a class="search"><i class="icon-search search-btn"></i></a></li>                               
                    </ul>
                    <div class="search-open">
                        <div class="input-append">
                            <form>
                                <input type="text" class="span3" placeholder="Search" />
                                <button type="submit" class="btn-u">Go</button>
                            </form>
                        </div>
                    </div>
                </div><!-- /nav-collapse -->                                
            </div><!-- /navbar-inner -->
        </div><!-- /navbar -->                          
    </div><!-- /container -->               
</div><!--/header -->      
<!--=== End Header ===-->

<!--=== Breadcrumbs ===-->
<div class="breadcrumbs margin-bottom-60">
	<div class="container">
        <h1 class="pull-left">Downloads</h1>
        <ul class="pull-right breadcrumb">
            <li><a href="../index.html">Home</a> <span class="divider">/</span></li>
            <li><a href="">Pages</a> <span class="divider">/</span></li>
            <li class="active">Downloads</li>
        </ul>
    </div><!--/container-->
</div><!--/breadcrumbs-->
<!--=== End Breadcrumbs ===-->

<!--=== Content Part ===-->
<div class="container">		
	<div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul id="sidebar" class="nav nav-list">
				<li class="nav-header develop_header" >In Development</li>
				<li class="nav-header stable_header">Stable Releases</li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
		<div class="span9 ">
			<div class="well">
			<h2 class="text-center main-header">CS-Studio 4.0.4</h2>
			<div class="text-center main-date"></div>
			<p class="alert alert-info"role="alert"><b>Requirements: </b><span class="eclipseVersion"></span> </p>
			<div class="text-center tabbable">
				<ul class="nav nav-tabs">
					<li class="active tabz" id="update_site-tab"><a href="#">Update Site</a></li>
					<li class="tabz" id="artifacts-tab"><a href="#">Artifacts</a></li>
				</ul>
			</div>
			<div class="tab-content">
				<div class="tab-pane active" id="update_site">
					<p>Add the following URL to your <b class="eclipseVersion"></b> installation, via:</p>
					<blockquote>Help > Install New Software... > Work with:</blockquote>
					<a class="updateSite" href=""></a>
					<p>Then select the individual features that you want to install</p>
				</div>
				<div class="tab-pane purchase" id="artifacts-pane">
					<p>Listed below are artifacts related to this release.</p>
					<p>Install into Eclipse via:</p>
					<blockquote>Help > Install New Software... > Work with:</blockquote>
					<a class = "btn btn-buy"href="">Download</a>
				</div>
			</div>
		</div>
       </div>
    </div><!--/row-fluid-->
</div><!--/container-->		
<!--=== End Content Part ===-->

<!--=== Footer ===-->
<div class="footer">
    <div class="container">
        <div class="row-fluid">
            <div class="span4">
                <!-- About -->
                <div class="headline"><h3>About</h3></div>
                <p class="margin-bottom-25">Control System Studio is an Eclipse-based collection of tools to monitor and operate large scale control systems, such as the ones in the accelerator community. It's a product of the collaboration between different laboratories and universities.</p>
                <div  class="frame_holder">
                	<h3 class="openhub-title"><a href="https://www.openhub.net/p/cs-studio" target="_blank" title="control system studio">Control System Studio</a></h3>  
                	<div class="widget_details">
                		<p>Main Language:
                			<a href="https://www.openhub.net/p/cs-studio/analyses/latest/languages_summary" style="right:-32px">
                				<span>Java</span>
                			</a>
                		</p>
                		<p> Total Lines of Code:
                			<a href="https://www.openhub.net/p/cs-studio/analyses/latest/languages_summary" style="right:-50px"><span>500,000</span></a>  <!--actual # does not matter, link is just placeholder to solve link problems-->
                		</p>
                		<p> Active Contributors: 
                			<a href="https://www.openhub.net/p/cs-studio/contributors" style="right:-20px"><span>31</span></a>
                		</p>
                		<p> Commit Activity Timeline: </p>
			</div>
                	<script type="text/javascript" src="http://www.ohloh.net/p/486835/widgets/project_basic_stats.js"></script>
                </div>

      


            </div><!--/span4-->

            <div class="span4">
            </div><!--/span4-->

            <div class="span4">
                <!-- Contact Us -->
                <div class="headline"><h3>Contact Us</h3></div>
                <address>

                
                    User Level Questions: <a href="http://www.aps.anl.gov/epics/tech-talk/">http://www.aps.anl.gov/epics/tech-talk/</a>
                    <br>
                    Developer Level Questions: <a href = "cs-studio-core@lists.sourceforge.net">cs-studio-core@lists.sourceforge.net</a>
                    <br>
                    Report Bugs/Problems: <a href="https://github.com/ControlSystemStudio/cs-studio/issues">https://github.com/ControlSystemStudio/cs-studio/issues</a>

                </address>

                <!-- Stay Connected -->
                <div class="headline"><h3>Stay Connected</h3></div>
                <ul class="social-icons">
                    <li><a href="https://plus.google.com/u/0/b/101349549663920375487/101349549663920375487/posts" data-original-title="Goole Plus" class="social_googleplus"></a></li>
                    <li><a href="https://github.com/ControlSystemStudio/cs-studio" data-original-title="Github" class="social_github"></a></li>
                </ul>
                <!--&lt;!&ndash; Monthly Newsletter &ndash;&gt;-->
                <!--<br>-->
                <!--<div class="headline"><h3>Monthly Newsletter</h3></div>-->
                <!--<p>Subscribe to our newsletter and stay up to date with the latest news and deals!</p>-->
                <!--<form class="form-inline">-->
                    <!--<div class="input-append">-->
                        <!--<input type="text" placeholder="Email Address" class="input-medium">-->
                        <!--<button class="btn-u">Subscribe</button>-->
                    <!--</div>-->
                <!--</form>-->
            </div><!--/span4-->
        </div><!--/row-fluid-->
    </div><!--/container-->
</div><!--/footer-->	
<!--=== End Footer ===-->

<!--=== Copyright ===-->
<div class="copyright">
	<div class="container">
		<div class="row-fluid">
			<div class="span8">						
	            <p>2013 &copy; Some copyright stuff here. <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
			</div>
			<div class="span4">	
				<a href="../index.html"><img id="logo-footer" src="../cs-studio/img/css.png" class="pull-right" alt="" /></a>
			</div>
		</div><!--/row-fluid-->
	</div><!--/container-->	
</div><!--/copyright-->	
<!--=== End Copyright ===-->

<!-- JS Global Compulsory -->			
<script type="text/javascript" src="../assets/js/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="../assets/js/modernizr.custom.js"></script>		
<script type="text/javascript" src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>	
<!-- JS Implementing Plugins -->           
<script type="text/javascript" src="../assets/plugins/flexslider/jquery.flexslider-min.js"></script>
<script type="text/javascript" src="../assets/plugins/parallax-slider/js/modernizr.js"></script>
<script type="text/javascript" src="../assets/plugins/parallax-slider/js/jquery.cslider.js"></script> 
<script type="text/javascript" src="../assets/plugins/back-to-top.js"></script>
<!-- JS Page Level -->           
<script type="text/javascript" src="../assets/js/app.js"></script>
<script type="text/javascript" src="../assets/js/pages/index.js"></script>
<script type="text/javascript" src="../assets/js/date.js"></script>
<script type="text/javascript" src="../assets/js/jquery.timeago.js" ></script>
<script type="text/javascript">
    jQuery(document).ready(function() {
        App.init();
        App.initSliders();
        Index.initParallaxSlider();

    });
</script>


<!--Link for every version-->
<!--Anthony Dionise-->
<script>
function getVersion(title){
	/*
	get the version number of the title
	*/
	var pattern = /\d+.\d+.\d+/;
	return String(pattern.exec(title));
}
function clean(stableReleases){
	/*
	get latest bug release
	*/
	
	var pattern = /\d+.\d+./; //get just version number
	var i, version,versionNumber,key;
	var bugNumber,bugIndex,officialBug;
	var versions_obj = {};
	var officialVersions = [];
	
	//create object with version number as properties and bug numbers as their respective values
	for (i=0; i<stableReleases.length; i++){
		version = stableReleases[i];
		versionNumber = String(pattern.exec(version)); //get version number
		bugIndex = version.lastIndexOf('.');
		bugNumber = +version.slice(bugIndex+1); //turn into integer to work properly later(max function)
		//only include versions above 3.2
		if (versionNumber > "3.2."){ 
			if (versions_obj.hasOwnProperty(versionNumber)){ //if object already has that version, add bugnumber to its array
				versions_obj[versionNumber].push(bugNumber);
			}
			else{
				versions_obj[versionNumber] = [bugNumber]; //otherwise, create a property for it and create array value with the bug number
			}
		};
	};
	
	//replace each property's array with their highest bug value and create array of latest versions
	for (key in versions_obj){
		officialBug = Math.max.apply(Math,versions_obj[key]);  
		versions_obj[key] = officialBug;
		officialVersions.push(key + String(versions_obj[key])); 
	};
	
	//return array of versions
	return officialVersions;
	
}

function createList(header,version){
	var anchor,item;
	
	//create link tag and append the version number
	anchor = $('<a href="#">').text(version);
	//create list element with anchor in it
	item = $('<li>').append(anchor);
	item.addClass('nav-link');
	//append li after given list header
	header.after(item);
	
	if (header.hasClass('develop_header')){
		item.addClass('in-develop-link');
	};
		
}
function getDate(date){
	var pattern = /\d{4}-\d{2}-\d{2}/
	return String(pattern.exec(date));
}
function getEclipseVersion(version,updateSite,eclipseVersion){
	/*
		make update site tab correspond to active link
	*/
	$.getJSON('https://spreadsheets.google.com/feeds/list/1CgJm2SxbDPWLyzNC1TSqvWlJHioF-sj-FLy9pPB2Fcg/od6/public/values?alt=json',function(data){
		$.each(data.feed.entry,function(key,val){
			var pattern = /\d.\d/;
			var csstudioVersion = pattern.exec(val.gsx$csstudioversion.$t);
			if (version == csstudioVersion){
				updateSite.text(val.gsx$csstudioupdatesite.$t);
				updateSite.attr("href",val.gsx$csstudioupdatesite.$t);
				eclipseVersion.text("Eclipse " + val.gsx$eclipseversionname.$t + " " + val.gsx$eclipseversion.$t);
			};
		});
	});
}

$(document).ready(function(){
	/*
		Algorithm:
			open closed milestones
			loop through each milestone, and push each stable version into stableReleases
			within closed milestones JSON, get open milestones JSON
			when json2 is done functioning,grab current version and testing version
			push current version into stableReleases
			stableReleases contains many duplicates with different bug numbers - 
			clean stableReleases so that it contains only the latest bug release of each version
			add each stable release to navbar after 'stable releases' header link
			add in devlopment version to navbar after 'in devlopment' header
			
	*/
	var page;
	var stableReleases = [];
	var currentRelease, inDevelopment;
	var releaseDates = {};
	//get closed milestones - append all past stable versions to stableReleases
	$.getJSON('https://api.github.com/repos/controlsystemstudio/cs-studio/milestones?state=closed',function(data){
		$.each(data,function(key,val){
			var version, title,date;
			title = val.title;
			date = val.closed_at;
			//if it is stable, strip out version number and add it to stable releases
			if (title.indexOf('stable') != -1){ //if 'stable' is found
				version = getVersion(title);
				stableReleases.push(version);
				
				//get dates
				date = getDate(date);
				releaseDates[version] = date;
				
			}
			
		});
		
		//get open milestones - grab current release and version in development
		$.getJSON('https://api.github.com/repos/controlsystemstudio/cs-studio/milestones',function(data){
			$.each(data,function(key,val){
				var version, title, date;
				title = val.title;
				date = val.updated_at;
				//if it is stable, strip out version number and add it to stable releases
				if (title.indexOf('stable') != -1){ //if 'stable' is found
					currentRelease = getVersion(title);
					
				}
				else{
					inDevelopment = getVersion(title);
					
				}
				releaseDates[getVersion(title)] = getDate(date);
			});
		}).done(function(){
			
			
			var i ;
			var latestRelease,date,mainHeader;
			//single out each version - latest bug release
			stableReleases = clean(stableReleases);
			stableReleases.push(currentRelease);
			stableReleases.sort();
			var header1 = $('.develop_header');
			var header2 = $('.stable_header');
			
			//append each version to appropriate section of the navbar
			for (i=0; i<stableReleases.length; i++){
				version = stableReleases[i];
				createList(header2,version);
			}
			createList(header1,inDevelopment);
			//*********************************************************
			
			//set defaults
			latestRelease = header2.next();
			mainHeader = $('.main-header');
			date = $('.main-date');
			
			latestRelease.addClass('active');
			mainHeader.text("CS-Studio " + latestRelease.text());
			date.text(releaseDates[latestRelease.text()]);
			
			
			
			$('.nav-link').click(function(){
				var linkText;
				$('.nav-link').removeClass('active');
				$(this).addClass('active');
				
				linkText = $(this).children().text();
				$('.main-header').text("CS-Studio " + linkText);
				$('.main-date').text(releaseDates[linkText]);
				
			});
			
			
			var panes = [];
			$('.tab-pane').each(function(){
				panes.push($(this));
			});
			$('.tabz').click(function(){
				var index = $(this).index();
				$('.tabz').removeClass('active');
				$(this).addClass('active');
				$('.tab-pane').removeClass('active');
				panes[index].addClass('active');
			});
		}).done(function(){
			//create artifacts URL 
			var activeLink,fullVersion,version,url,updateSite,eclipseVersion;
			
			activeLink = $('#sidebar').children('li.active');
			fullVersion = activeLink.children("a").text();
			version = String(/\d+.\d+/.exec(fullVersion));
			//update site info
			eclipseVersion = $('.eclipseVersion');
			updateSite = $('.updateSite');
			
			getEclipseVersion(version,updateSite,eclipseVersion);
			if (activeLink.hasClass('in-develop-link')){
					url = "https://openepics.ci.cloudbees.com/view/CS-Studio%204.1/job/CS-Studio%20-%20Product%20-%20";
			}else{
					url = "http://download.controlsystemstudio.org/release/4.1";
			};
			url += version + "/";
			$('#artifacts-pane').children('a').attr("href",url);
			
			//if user switches versions, change url to match version
			$('#sidebar').children('li').click(function(){
				activeLink = $('#sidebar').children('li.active');
				fullVersion = $('#sidebar').children('li.active').children("a").text();
				version = String(/\d+.\d+/.exec(fullVersion));
				
				getEclipseVersion(version,updateSite,eclipseVersion);
				if (activeLink.hasClass('in-develop-link')){
					url = "https://openepics.ci.cloudbees.com/view/CS-Studio%20";
				}else{
					url = "http://download.controlsystemstudio.org/release/4.1";
				};
			
				
				url += version + "/";
				$('#artifacts-pane').children('a').attr("href",url);
				
			});
			
		   
		});
		
	});

})

</script>

<!--[if lt IE 9]>
<script src="../assets/js/respond.js"></script>
<![endif]-->

<div id="topcontrol" title="Scroll Back to Top" style="position: fixed; bottom: 5px; right: 5px; opacity: 1; cursor: pointer;"><img src="../assets/img/up.png" style="width:51px; height:42px"></div>
</body>
</html> 
